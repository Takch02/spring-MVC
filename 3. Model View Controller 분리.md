# 각 기능의 분리
Spring MVC에서 3개의 기능 분리는 대단히 중요하다. 통합하면 왜 불편하고 유지보수가 힘든지 만들어보자.

(form 반환 class, save class, list class 3개를 전부 구현은 코드가 길어지므로 save class 만 구현해보자.)

## Version 1

일단 구현 클래스는 interface 로 만든다.

```
public interface ControllerV1 {

    void process (HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException;
}
```
request, response를 parameter로 갖는 클래스를 만들고 여기에 save class를 만들자.

```
public class MemberSaveControllerV1 implements ControllerV1 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public void process (HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {


        String username = req.getParameter("username");
        int age = Integer.parseInt(req.getParameter("age"));
        Member member = new Member(username, age);

        memberRepository.save(member);

        String url = "/WEB-INF/views/save-result.jsp";
        req.setAttribute("member", member);

        RequestDispatcher dispatcher = req.getRequestDispatcher(url);
        dispatcher.forward(req, resp);


    }
}
```
먼저 request는 요청을 받았으므로 데이터가 들어있다. "2. 웹 어플리케이션 만들기" 에서 repository를 그대로 사용하므로
parameter는 "username", "age"로 동일하다.

parameter를 뽑아서 저장하고 save-result.jsp가 있는 url을 RequestDispatcher에 넣어 forward 시키면 해당 내용이 save-result.jsp로
넘어간다.

여기서 req.setAttribute를 통해 model 안에 데이터를 넣는다. 이렇게 넣은 데이터는 jsp로 넘어가 사용 가능하다.

개선 사항이 보이는데 
```
RequestDispatcher dispatcher = req.getRequestDispatcher(url);
dispatcher.forward(req, resp);
```
이 코드는 다른 클래스를 구현해도 필연적이므로 클래스를 하나 만들어서 묶을 수 있다.
```
String url = "/WEB-INF/views/save-result.jsp";
```
url을 넘기는데 "/WEB-INF/views" 주소는 계속 중복된다. 이러한 고정 주소를 제외하고 save-result의 주소를 논리 주소라 하는데
클래스 구현 시 논리 주소만 사용하도록 만들면 개발자가 더 편해질 것이다.

## Version 3

위의 개선사항을 고려하여 다시 만들어보자.

```
@Getter @Setter
public class ModelView {

    private String viewName;
    private Map<String, Object> model = new HashMap<>();

    public ModelView(String viewName) {
        this.viewName = viewName;
    }
}
```
ModelView 객체를 만들었는데 이는 논리 주소가 담긴 viewName, model이 담긴 Map을 만들었다.
Model 안에 내용을 담고 ModelView를 통해 이용 가능하다.

```
public class MyView {

    private String viewPath;

    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }

    public void render (HttpServletRequest req, HttpServletResponse res) throws IOException, ServletException {

        RequestDispatcher dispatcher = req.getRequestDispatcher(viewPath);
        dispatcher.forward(req, res);
    }

    public void render (Map<String, Object> model, HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
        modelToRequestAttributes(model, req);
        RequestDispatcher dispatcher = req.getRequestDispatcher(viewPath);
        dispatcher.forward(req, res);

    }

    private void modelToRequestAttributes (Map<String, Object> model, HttpServletRequest request) {

        model.forEach((key, value) -> request.setAttribute(key, value));
    }
}
```
View 클래스를 만들었다. 


